<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sketch Pro Dashboard - Multi Market</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        /* TV optimization - scale up fonts for better readability */
        body {
            font-size: 18px;
        }
        
        /* Ensure market cards wrap properly when adding more */
        .RightSide {
            flex-wrap: wrap !important;
        }
        
        /* Scale numbers slightly larger */
        .NoStudios {
            font-size: 180px !important;
        }
    </style>
</head>
<body style="margin: 0; padding: 0; font-family: Inter, sans-serif; background: #F7F8FD; overflow-x: hidden;">

<div data-layer="dashboard" class="Dashboard" style="width: 100vw; min-height: 100vh; justify-content: flex-start; align-items: stretch; gap: 20px; display: flex; padding: 24px; box-sizing: border-box;">
  <!-- LEFT SIDE (unchanged) -->
  <div data-layer="left-side" class="LeftSide" style="width: 380px; align-self: stretch; flex-direction: column; justify-content: flex-start; align-items: center; gap: 24px; display: inline-flex; flex-shrink: 0;">
    <div data-layer="Frame 24" class="Frame24" style="width: 100%; height: 140px; position: relative; background: linear-gradient(135deg, #3a3180 0%, #272264 100%); border-bottom-right-radius: 20px; border-bottom-left-radius: 20px; display: flex; align-items: center; justify-content: center;">
      <img data-layer="sketch-full-white 1" class="SketchFullWhite1" style="width: 260px; height: auto;" src="sketch-full-white.png" />
    </div>
    <div data-layer="content" class="Content" style="width: 100%; height: 898px; flex-direction: column; justify-content: flex-start; align-items: center; gap: 66px; display: flex">
      <div data-layer="box-summary-all" class="BoxSummaryAll" style="align-self: stretch; height: 898px; padding-top: 32px; padding-bottom: 32px; background: linear-gradient(135deg, #3a3180 0%, #272264 100%); border-radius: 20px; flex-direction: column; justify-content: space-between; align-items: center; display: flex">
        <div data-layer="Frame 22" class="Frame22" style="width: 281px; flex-direction: column; justify-content: center; align-items: center; gap: 8px; display: flex">
          <div data-layer="summary-studios-open" class="SummaryStudiosOpen" style="align-self: stretch; height: 202px; flex-direction: column; justify-content: flex-start; align-items: flex-start; gap: 14px; display: flex">
            <div data-layer="No. of Studios Open" class="NoOfStudiosOpen" style="align-self: stretch; text-align: center; color: #D1CAF8; font-size: 16px; font-family: Inter; font-weight: 700; word-wrap: break-word">No. of Studios Open</div>
            <div data-layer="studios-open" class="NoStudios" style="align-self: stretch; height: 161px; text-align: center; justify-content: center; display: flex; flex-direction: column; color: white; font-size: 160px; font-family: Inter; font-weight: 700; word-wrap: break-word">6</div>
          </div>
          <div data-layer="summary-nps-score" class="SummaryNpsScore" style="width: 204px; height: 70px; position: relative; background: #514688; border-radius: 5px">
            <div data-layer="Frame 17" class="Frame17" style="padding-left: 4px; padding-right: 4px; left: 14px; top: 0px; position: absolute; flex-direction: column; justify-content: flex-start; align-items: center; gap: 10px; display: inline-flex">
              <div data-layer="avg-nps-score" class="AvgNpsScore" style="width: 170px; height: 70px; left: 0px; top: 0px; position: absolute; text-align: right; justify-content: center; display: flex; flex-direction: column; color: white; font-size: 40px; font-family: Inter; font-weight: 700; word-wrap: break-word">68</div>
              <div data-layer="Avg. NPS score" class="AvgNpsScore" style="width: 91px; height: 70px; justify-content: center; display: flex; flex-direction: column; color: white; font-size: 12px; font-family: Inter; font-weight: 700; word-wrap: break-word">Avg. NPS score</div>
            </div>
          </div>
          <div data-layer="summary-no-people" class="SummaryNoPeople" style="width: 204px; height: 70px; position: relative; background: #514688; border-radius: 5px">
            <div data-layer="Frame 18" class="Frame18" style="width: 184px; height: 70px; padding-left: 18px; padding-right: 18px; left: 0px; top: 0px; position: absolute; justify-content: flex-start; align-items: center; gap: 10px; display: inline-flex">
              <div data-layer="people" class="People" style="width: 165px; height: 70px; left: 18.50px; top: -0.50px; position: absolute; text-align: right; justify-content: center; display: flex; flex-direction: column; color: white; font-size: 40px; font-family: Inter; font-weight: 700; word-wrap: break-word">102</div>
              <div data-layer="No. of people" class="NoOfPeople" style="justify-content: center; display: flex; flex-direction: column; color: white; font-size: 12px; font-family: Inter; font-weight: 700; word-wrap: break-word">No. of people</div>
            </div>
          </div>
          <div data-layer="summary-total-assets" class="SummaryTotalAssets" style="width: 204px; height: 90px; position: relative; background: #514688; border-radius: 5px">
            <div data-layer="Frame 19" class="Frame19" style="width: 187px; height: 60px; left: 17.50px; top: 13.50px; position: absolute; flex-direction: column; justify-content: center; align-items: center; display: inline-flex">
              <div data-layer="Total assets" class="TotalAssets" style="align-self: stretch; height: 20px; justify-content: center; display: flex; flex-direction: column; color: white; font-size: 12px; font-family: Inter; font-weight: 700; word-wrap: break-word">Total assets</div>
              <div data-layer="total-assets" class="TotalAssets" style="align-self: stretch; justify-content: center; display: flex; flex-direction: column; color: white; font-size: 40px; font-family: Inter; font-weight: 700; word-wrap: break-word">100,002</div>
            </div>
          </div>
          <div data-layer="summary-total-saved" class="SummaryTotalSaved" style="width: 204px; height: 90px; position: relative; background: #514688; border-radius: 5px">
            <div data-layer="Frame 20" class="Frame20" style="width: 186px; left: 18.50px; top: 9.50px; position: absolute; flex-direction: column; justify-content: flex-start; align-items: center; display: inline-flex">
              <div data-layer="Total saved (€)" class="TotalSaved" style="align-self: stretch; height: 20px; justify-content: center; display: flex; flex-direction: column; color: white; font-size: 12px; font-family: Inter; font-weight: 700; word-wrap: break-word">Total saved (€)</div>
              <div data-layer="total-saved" class="TotalSaved" style="align-self: stretch; justify-content: center; display: flex; flex-direction: column; color: white; font-size: 40px; font-family: Inter; font-weight: 700; word-wrap: break-word">427,300</div>
            </div>
          </div>
          <div data-layer="summary-divide" class="SummaryDivide" style="width: 197px; height: 44px; justify-content: flex-start; align-items: flex-start; gap: 8px; display: inline-flex">
            <div data-layer="This Month" class="ThisMonth" style="flex: 1 1 0; align-self: stretch; justify-content: center; display: flex; flex-direction: column; color: #D1CAF8; font-size: 10.70px; font-family: Inter; font-weight: 800; word-wrap: break-word">This Month</div>
          </div>
          <div data-layer="box-top-markets" class="BoxTopMarkets" style="width: 204px; height: 218px; position: relative; background: #514688; border-radius: 5px">
            <div data-layer="Top-performing-markets" class="TopPerformingMarkets" style="width: 183px; left: 11px; top: 14px; position: absolute; flex-direction: column; justify-content: flex-start; align-items: flex-start; gap: 13px; display: inline-flex">
              <div data-layer="Top Performing Markets" class="TopPerformingMarkets" style="align-self: stretch; color: white; font-size: 12px; font-family: Inter; font-weight: 700; word-wrap: break-word">Top Performing Markets</div>
              <div data-layer="Frame 21" class="Frame21" style="align-self: stretch; flex-direction: column; justify-content: flex-start; align-items: flex-start; gap: 1px; display: flex">
                <div data-layer="market" class="Market" style="align-self: stretch; justify-content: flex-start; align-items: center; gap: 9px; display: inline-flex">
                  <div data-layer="flag" class="Flag" style="width: 21px; height: 21px; background: white; border-radius: 9999px"></div>
                  <div data-layer="Indonesia" class="Indonesia" style="flex: 1 1 0; color: white; font-size: 14px; font-family: Inter; font-weight: 700; line-height: 32px; word-wrap: break-word">Indonesia</div>
                </div>
                <div data-layer="market" class="Market" style="align-self: stretch; justify-content: flex-start; align-items: center; gap: 9px; display: inline-flex">
                  <div data-layer="flag" class="Flag" style="width: 21px; height: 21px; background: white; border-radius: 9999px"></div>
                  <div data-layer="Indonesia" class="Indonesia" style="flex: 1 1 0; color: white; font-size: 14px; font-family: Inter; font-weight: 700; line-height: 32px; word-wrap: break-word">Indonesia</div>
                </div>
                <div data-layer="market" class="Market" style="align-self: stretch; justify-content: flex-start; align-items: center; gap: 9px; display: inline-flex">
                  <div data-layer="flag" class="Flag" style="width: 21px; height: 21px; background: white; border-radius: 9999px"></div>
                  <div data-layer="Indonesia" class="Indonesia" style="flex: 1 1 0; color: white; font-size: 14px; font-family: Inter; font-weight: 700; line-height: 32px; word-wrap: break-word">Indonesia</div>
                </div>
                <div data-layer="market" class="Market" style="align-self: stretch; justify-content: flex-start; align-items: center; gap: 9px; display: inline-flex">
                  <div data-layer="flag" class="Flag" style="width: 21px; height: 21px; background: white; border-radius: 9999px"></div>
                  <div data-layer="Indonesia" class="Indonesia" style="flex: 1 1 0; color: white; font-size: 14px; font-family: Inter; font-weight: 700; line-height: 32px; word-wrap: break-word">Indonesia</div>
                </div>
                <div data-layer="market" class="Market" style="align-self: stretch; justify-content: flex-start; align-items: center; gap: 9px; display: inline-flex">
                  <div data-layer="flag" class="Flag" style="width: 21px; height: 21px; background: white; border-radius: 9999px"></div>
                  <div data-layer="Indonesia" class="Indonesia" style="flex: 1 1 0; color: white; font-size: 14px; font-family: Inter; font-weight: 700; line-height: 32px; word-wrap: break-word">Indonesia</div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- RIGHT SIDE - Market Cards Container -->
  <div id="marketCardsContainer" data-layer="right-side" class="RightSide" style="flex: 1; align-self: stretch; justify-content: flex-start; align-items: flex-start; gap: 20px; display: flex; overflow-x: auto; padding: 0; margin-top: 0;">
    <!-- Market cards will be dynamically generated here -->
  </div>
</div>

<script>
// Global data structure
const globalData = {
  "studios-open": "6",
  "avg-nps-score": "58",
  "people": "20",
  "total-assets": "1,964",
  "total-saved": "657,472"
};

// Market-specific data
const marketsData = {
  "Brazil": {
    "market-flag": "https://upload.wikimedia.org/wikipedia/en/0/05/Flag_of_Brazil.svg",
    "monthly-roi": "0.3",
    "monthly-saving": "5,208",
    "monthly-arrow": "down",
    "monthly-assets": "91",
    "monthly-assets-difference": "-0.65",
    "monthly-high-complexity": "0",
    "monthly-mid-complexity": "0",
    "monthly-low-complexity": "0",
    "monthly-high-complexity-days": "0",
    "monthly-mid-complexity-days": "0",
    "monthly-low-complexity-days": "0",
    "monthly-ai-usage": "8",
    "monthly-team-utilsation": "0",
    "ytd-assets-total": "933",
    "ytd-savings-total": "157,657",
    "ytd-roi-total": "1.5",
    "market-nps-score": "86"
  },
  "China": {
    "market-flag": "https://upload.wikimedia.org/wikipedia/commons/0/0f/Flag_of_the_People%27s_Republic_of_China.svg",
    "monthly-roi": "0.3",
    "monthly-saving": "4,690",
    "monthly-arrow": "up",
    "monthly-assets": "77",
    "monthly-assets-difference": "1.14",
    "monthly-high-complexity": "0",
    "monthly-mid-complexity": "0",
    "monthly-low-complexity": "0",
    "monthly-high-complexity-days": "0",
    "monthly-mid-complexity-days": "0",
    "monthly-low-complexity-days": "0",
    "monthly-ai-usage": "46",
    "monthly-team-utilsation": "0",
    "ytd-assets-total": "140",
    "ytd-savings-total": "5,797",
    "ytd-roi-total": "-0.2",
    "market-nps-score": "0"
  },
  "India": {
    "market-flag": "https://upload.wikimedia.org/wikipedia/en/4/41/Flag_of_India.svg",
    "monthly-roi": "3",
    "monthly-saving": "32,761",
    "monthly-arrow": "up",
    "monthly-assets": "118",
    "monthly-assets-difference": "1.88",
    "monthly-high-complexity": "0",
    "monthly-mid-complexity": "0",
    "monthly-low-complexity": "0",
    "monthly-high-complexity-days": "0",
    "monthly-mid-complexity-days": "0",
    "monthly-low-complexity-days": "0",
    "monthly-ai-usage": "15",
    "monthly-team-utilsation": "0",
    "ytd-assets-total": "756",
    "ytd-savings-total": "56,288",
    "ytd-roi-total": "0.6",
    "market-nps-score": "50"
  },
  "Indonesia": {
    "market-flag": "https://upload.wikimedia.org/wikipedia/commons/9/9f/Flag_of_Indonesia.svg",
    "monthly-roi": "2.1",
    "monthly-saving": "21,690",
    "monthly-arrow": "down",
    "monthly-assets": "187",
    "monthly-assets-difference": "-0.18",
    "monthly-high-complexity": "0",
    "monthly-mid-complexity": "0",
    "monthly-low-complexity": "0",
    "monthly-high-complexity-days": "0",
    "monthly-mid-complexity-days": "0",
    "monthly-low-complexity-days": "0",
    "monthly-ai-usage": "52",
    "monthly-team-utilsation": "0",
    "ytd-assets-total": "187",
    "ytd-savings-total": "472,729",
    "ytd-roi-total": "5.3",
    "market-nps-score": "38"
  },
  "South Africa": {
    "market-flag": "https://upload.wikimedia.org/wikipedia/commons/a/af/Flag_of_South_Africa.svg",
    "monthly-roi": "0",
    "monthly-saving": "-567",
    "monthly-arrow": "up",
    "monthly-assets": "34",
    "monthly-assets-difference": "1.83",
    "monthly-high-complexity": "0",
    "monthly-mid-complexity": "0",
    "monthly-low-complexity": "0",
    "monthly-high-complexity-days": "0",
    "monthly-mid-complexity-days": "0",
    "monthly-low-complexity-days": "0",
    "monthly-ai-usage": "64",
    "monthly-team-utilsation": "0",
    "ytd-assets-total": "47",
    "ytd-savings-total": "-22,651",
    "ytd-roi-total": "-0.6",
    "market-nps-score": "0"
  },
  "Turkey": {
    "market-flag": "https://upload.wikimedia.org/wikipedia/commons/b/b4/Flag_of_Turkey.svg",
    "monthly-roi": "-0.7",
    "monthly-saving": "-12,347",
    "monthly-arrow": "up",
    "monthly-assets": "52",
    "monthly-assets-difference": "0",
    "monthly-high-complexity": "0",
    "monthly-mid-complexity": "0",
    "monthly-low-complexity": "0",
    "monthly-high-complexity-days": "0",
    "monthly-mid-complexity-days": "0",
    "monthly-low-complexity-days": "0",
    "monthly-ai-usage": "71",
    "monthly-team-utilsation": "0",
    "ytd-assets-total": "88",
    "ytd-savings-total": "-12,348",
    "ytd-roi-total": "-0.7",
    "market-nps-score": "0"
  }
};

// Function to create a sparkline SVG from data array
function createSparkline(data, width = 120, height = 30, color = '#574BB8') {
    if (!data || data.length === 0) return '';
    
    const max = Math.max(...data);
    const min = Math.min(...data);
    const range = max - min || 1;
    
    const points = data.map((value, index) => {
        const x = (index / (data.length - 1)) * width;
        const y = height - ((value - min) / range) * height;
        return `${x},${y}`;
    }).join(' ');
    
    return `
        <svg width="${width}" height="${height}" style="display: block;">
            <polyline
                points="${points}"
                fill="none"
                stroke="${color}"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
            />
            <circle cx="${width}" cy="${height - ((data[data.length - 1] - min) / range) * height}" r="3" fill="${color}" />
        </svg>
    `;
}

// Function to get color based on ROI value
function getROIColor(roi) {
    const value = parseFloat(roi);
    if (value >= 2.0) return '#E9FAEF'; // Green (current green)
    if (value >= 1.5) return '#FFF9E6'; // Yellow/Amber
    return '#FFE9E9'; // Red/Pink
}

// Function to get text color based on ROI value
function getROITextColor(roi) {
    const value = parseFloat(roi);
    if (value >= 2.0) return '#58A97F'; // Green text
    if (value >= 1.5) return '#B8860B'; // Dark golden/amber text
    return '#D14545'; // Red text
}

// Function to get color based on NPS score
function getNPSColor(nps) {
    const value = parseFloat(nps);
    if (value >= 80) return '#E9FAEF'; // Green
    if (value >= 70) return '#FFF9E6'; // Yellow/Amber
    return '#FFE9E9'; // Red/Pink
}

// Function to get text color based on NPS score
function getNPSTextColor(nps) {
    const value = parseFloat(nps);
    if (value >= 80) return '#58A97F'; // Green text
    if (value >= 70) return '#B8860B'; // Dark golden/amber text
    return '#D14545'; // Red text
}

// Function to create a single market card
function createMarketCard(marketName, marketData) {
    const card = document.createElement('div');
    card.className = 'CardMarket';
    card.style = 'width: 280px; min-width: 280px; height: 980px; position: relative; background: white; box-shadow: 0px 0px 20px rgba(86, 80, 177, 0.12); border-radius: 20px;';
    
    // Calculate bar widths for complexity
    const highBarWidth = Math.round(91 * (parseFloat(marketData['monthly-high-complexity']) / 100));
    const midBarWidth = Math.round(91 * (parseFloat(marketData['monthly-mid-complexity']) / 100));
    const lowBarWidth = Math.round(91 * (parseFloat(marketData['monthly-low-complexity']) / 100));
    
    card.innerHTML = `
      <div class="Frame13" style="width: 240px; left: 20px; top: 20px; position: absolute; flex-direction: column; justify-content: flex-start; align-items: flex-start; gap: 14px; display: inline-flex">
        <div class="BoxMarket" style="width: 240px; justify-content: flex-start; align-items: center; display: inline-flex">
          <div class="MarketName" style="flex: 1 1 0; color: #272264; font-size: 20px; font-family: Inter; font-weight: 900; word-wrap: break-word">${marketName}</div>
          <img class="MarketFlag" style="width: 49.31px; height: 34.51px; border-radius: 5px" src="${marketData['market-flag']}" />
        </div>
        <div class="SummaryDivide" style="width: 240px; height: 32px; justify-content: flex-start; align-items: flex-start; gap: 8px; display: inline-flex">
          <div class="Month" style="width: 240px; align-self: stretch; justify-content: center; display: flex; flex-direction: column; color: #584C89; font-size: 14px; font-family: Inter; font-weight: 800; word-wrap: break-word">Month</div>
        </div>
        <div class="MonthlyTop" style="align-self: stretch; justify-content: flex-start; align-items: center; gap: 8px; display: inline-flex">
          <div class="BoxMonthlyRoi" style="width: 75px; height: 75px; position: relative; background: ${getROIColor(marketData['monthly-roi'])}; border-radius: 5px">
            <div class="Frame5" style="width: 59px; left: 8px; top: 50%; transform: translateY(-50%); position: absolute; flex-direction: column; justify-content: center; align-items: flex-start; display: inline-flex">
              <div class="Roi" style="align-self: stretch; height: 12px; color: ${getROITextColor(marketData['monthly-roi'])}; font-size: 10px; font-family: Inter; font-weight: 800; word-wrap: break-word">ROI</div>
              <div class="MonthlyRoi" style="width: 59px; flex: 1 1 0; justify-content: center; display: flex; flex-direction: column; color: ${getROITextColor(marketData['monthly-roi'])}; font-size: 24px; font-family: Inter; font-weight: 700; word-wrap: break-word">${marketData['monthly-roi']}</div>
            </div>
          </div>
          <div class="BoxMonthlySaving" style="flex: 1 1 0; height: 75px; position: relative; background: #F7F8FD; border-radius: 5px">
            <div class="Saving" style="left: 8.02px; top: 50%; transform: translateY(-50%); position: absolute; flex-direction: column; justify-content: center; align-items: flex-start; display: inline-flex">
              <div class="Saving" style="align-self: stretch; height: 12px; color: #584C89; font-size: 12px; font-family: Inter; font-weight: 400; white-space: nowrap; word-wrap: break-word">Saving (€)</div>
              <div class="MonthlySaving" style="align-self: stretch; flex: 1 1 0; justify-content: center; display: flex; flex-direction: column; color: #584C89; font-size: 24px; font-family: Inter; font-weight: 700; word-wrap: break-word">${marketData['monthly-saving']}</div>
            </div>
          </div>
        </div>
        <div class="BoxMonthlyAssets" style="align-self: stretch; height: 120px; position: relative; background: #F7F8FD; border-radius: 5px">
          <div class="Frame10" style="width: 177px; left: 12.52px; top: 50%; transform: translateY(-50%); position: absolute; justify-content: flex-start; align-items: flex-start; gap: 1px; display: inline-flex">
            <div class="Frame9" style="width: 120px; height: 84px; flex-direction: column; justify-content: space-between; align-items: flex-start; display: inline-flex">
              <div class="Assets" style="align-self: stretch; height: 16px; color: #584C89; font-size: 12px; font-family: Inter; font-weight: 400; word-wrap: break-word">Assets</div>
              <div class="MonthlyAssets" style="align-self: stretch; height: 84px; color: #584C89; font-size: 64px; font-family: Inter; font-weight: 700; line-height: 60px; word-wrap: break-word">${marketData['monthly-assets']}</div>
            </div>
            <div class="Divide" style="width: 0.50px; height: 74.64px; background: #584C89"></div>
            <div class="Frame8" style="flex: 1 1 0; align-self: stretch; padding-left: 8px; padding-right: 8px; padding-top: 20px; padding-bottom: 20px; flex-direction: column; justify-content: center; align-items: center; gap: 5px; display: inline-flex">
              <div class="MonthlyAssetsDifference" style="align-self: stretch; text-align: center; justify-content: center; display: flex; flex-direction: column; color: #584C89; font-size: 14px; font-family: Inter; font-weight: 800; word-wrap: break-word">${marketData['monthly-assets-difference']}%</div>
              <div style="width: 0; height: 0; border-left: 6px solid transparent; border-right: 6px solid transparent; ${parseFloat(marketData['monthly-assets-difference']) >= 0 ? 'border-bottom: 8px solid #27DA6D;' : 'border-top: 8px solid #D14545;'}"></div>
            </div>
          </div>
        </div>
        <div class="BoxMonthlyComplexity" style="align-self: stretch; height: 160px; position: relative; background: #F7F8FD; border-radius: 5px">
          <div class="MonthlyComplexity" style="width: 166px; left: 12.02px; top: 50%; transform: translateY(-50%); position: absolute; flex-direction: column; justify-content: flex-start; align-items: flex-start; gap: 12px; display: inline-flex">
            <div class="HeaderRow" style="width: 100%; justify-content: space-between; align-items: center; display: flex;">
              <div class="Complexity" style="color: #584C89; font-size: 12px; font-family: Inter; font-weight: 400; word-wrap: break-word">Complexity</div>
              <div class="AvgDays" style="text-align: right; color: #584C89; font-size: 12px; font-family: Inter; font-weight: 400; word-wrap: break-word">Avg. Days</div>
            </div>
            <div class="ContentRow" style="width: 100%; justify-content: space-between; align-items: flex-start; gap: 8px; display: flex;">
              <div class="Complexity" style="flex-direction: column; justify-content: flex-start; align-items: flex-start; gap: 8px; display: flex">
                <div class="ComplexHighAll" style="flex-direction: column; justify-content: flex-start; align-items: flex-start; display: flex">
                  <div class="ComplexHigh" style="width: 91px; height: 22px; justify-content: flex-start; align-items: center; gap: 3px; display: inline-flex">
                    <div class="High" style="flex: 1 1 0; justify-content: center; display: flex; flex-direction: column; color: #584C89; font-size: 10px; font-family: Inter; font-weight: 700; line-height: 23.01px; word-wrap: break-word">High</div>
                    <div class="MonthlyHighComplexity" style="flex: 1 1 0; height: 22px; text-align: right; justify-content: center; display: flex; flex-direction: column; color: #584C89; font-size: 10px; font-family: Inter; font-weight: 700; line-height: 26.30px; word-wrap: break-word">${marketData['monthly-high-complexity']}%</div>
                  </div>
                  <div class="ComplexityGraphHigh" style="width: 91px; height: 5px; position: relative">
                    <div class="Bg" style="width: 91px; height: 3px; left: 0px; top: 0px; position: absolute; background: white; border-radius: 10px"></div>
                    <div class="BarHigh" style="width: ${highBarWidth}px; height: 3px; left: 0px; top: 0px; position: absolute; background: linear-gradient(90deg, #574BB8 0%, #9581C3 100%); border-radius: 10px"></div>
                  </div>
                </div>
                <div class="ComplexMidAll" style="width: 91px; flex-direction: column; justify-content: flex-start; align-items: flex-start; display: flex">
                  <div class="ComplexMid" style="width: 91px; height: 22px; justify-content: flex-start; align-items: center; gap: 3px; display: inline-flex">
                    <div class="Mid" style="flex: 1 1 0; justify-content: center; display: flex; flex-direction: column; color: #584C89; font-size: 10px; font-family: Inter; font-weight: 700; line-height: 23.01px; word-wrap: break-word">Mid</div>
                    <div class="MonthlyMidComplexity" style="flex: 1 1 0; height: 22px; text-align: right; justify-content: center; display: flex; flex-direction: column; color: #584C89; font-size: 10px; font-family: Inter; font-weight: 700; line-height: 26.30px; word-wrap: break-word">${marketData['monthly-mid-complexity']}%</div>
                  </div>
                  <div class="ComplexityGraphMid" style="width: 91px; height: 5px; position: relative">
                    <div class="Bg" style="width: 91px; height: 3px; left: 0px; top: 0px; position: absolute; background: white; border-radius: 10px"></div>
                    <div class="BarMid" style="width: ${midBarWidth}px; height: 3px; left: 0px; top: 0px; position: absolute; background: linear-gradient(90deg, #574BB8 0%, #9581C3 100%); border-radius: 10px"></div>
                  </div>
                </div>
                <div class="ComplexLowAll" style="width: 91px; flex-direction: column; justify-content: flex-start; align-items: flex-start; display: flex">
                  <div class="ComplexHigh" style="width: 91px; height: 22px; justify-content: flex-start; align-items: center; gap: 3px; display: inline-flex">
                    <div class="Low" style="flex: 1 1 0; justify-content: center; display: flex; flex-direction: column; color: #584C89; font-size: 10px; font-family: Inter; font-weight: 700; line-height: 23.01px; word-wrap: break-word">Low</div>
                    <div class="MonthlyLowComplexity" style="flex: 1 1 0; height: 22px; text-align: right; justify-content: center; display: flex; flex-direction: column; color: #584C89; font-size: 10px; font-family: Inter; font-weight: 700; line-height: 26.30px; word-wrap: break-word">${marketData['monthly-low-complexity']}%</div>
                  </div>
                  <div class="ComplexityGraphHigh" style="width: 91px; height: 5px; position: relative">
                    <div class="Bg" style="width: 91px; height: 3px; left: 0px; top: 0px; position: absolute; background: white; border-radius: 10px"></div>
                    <div class="BarLow" style="width: ${lowBarWidth}px; height: 3px; left: 0px; top: 0px; position: absolute; background: linear-gradient(90deg, #574BB8 0%, #9581C3 100%); border-radius: 10px"></div>
                  </div>
                </div>
              </div>
              <div class="AvgDays" style="flex-direction: column; justify-content: flex-start; align-items: flex-end; gap: 8px; display: inline-flex">
                <div class="AvgDaysHigh" style="width: 40px; height: 22px; position: relative">
                  <div class="Rectangle132" style="width: 40px; height: 22px; left: 0px; top: 0px; position: absolute; background: white; border-radius: 5px"></div>
                  <div class="MonthlyHighComplexityDays" style="width: 40px; height: 22px; left: 0px; top: 0px; position: absolute; text-align: center; justify-content: center; display: flex; flex-direction: column; color: #584C89; font-size: 10px; font-family: Inter; font-weight: 700; line-height: 26.30px; word-wrap: break-word">${marketData['monthly-high-complexity-days']}</div>
                </div>
                <div class="AvgDaysMid" style="width: 40px; height: 22px; position: relative">
                  <div class="Rectangle251" style="width: 40px; height: 22px; left: 0px; top: 0px; position: absolute; background: white; border-radius: 5px"></div>
                  <div class="MonthlyMidComplexityDays" style="width: 40px; height: 22px; left: 0px; top: 0px; position: absolute; text-align: center; justify-content: center; display: flex; flex-direction: column; color: #584C89; font-size: 10px; font-family: Inter; font-weight: 700; line-height: 26.30px; word-wrap: break-word">${marketData['monthly-mid-complexity-days']}</div>
                </div>
                <div class="AvgDaysLow" style="width: 40px; height: 22px; position: relative">
                  <div class="Rectangle252" style="width: 40px; height: 22px; left: 0px; top: 0px; position: absolute; background: white; border-radius: 5px"></div>
                  <div class="MonthlyLowComplexityDays" style="width: 40px; height: 22px; left: 0px; top: 0px; position: absolute; text-align: center; justify-content: center; display: flex; flex-direction: column; color: #584C89; font-size: 10px; font-family: Inter; font-weight: 700; line-height: 26.30px; word-wrap: break-word">${marketData['monthly-low-complexity-days']}</div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="Frame16" style="width: 240px; height: 75px; justify-content: center; align-items: flex-start; gap: 8px; display: inline-flex">
          <div class="BoxAiUsage" style="flex: 1 1 0; align-self: stretch; background: #F7F8FD; border-radius: 5px; flex-direction: column; justify-content: center; align-items: center; gap: 10px; display: inline-flex">
            <div class="AiUsage" style="align-self: stretch; flex-direction: column; justify-content: center; align-items: center; display: flex">
              <div class="Frame11" style="width: 68px; flex-direction: column; justify-content: center; align-items: center; gap: 4px; display: flex">
                <div class="AiUsage" style="align-self: stretch; text-align: center; justify-content: center; display: flex; flex-direction: column; color: #584C89; font-size: 12px; font-family: Inter; font-weight: 400; word-wrap: break-word">AI Usage</div>
                <div class="Frame23" style="align-self: stretch; justify-content: center; align-items: center; display: inline-flex">
                  <div class="MonthlyAiUsage" style="text-align: center; color: #584C89; font-size: 24px; font-family: Inter; font-weight: 700; word-wrap: break-word">${marketData['monthly-ai-usage']}</div>
                  <div class="Percentage" style="width: 11px; align-self: stretch; text-align: center; justify-content: flex-end; display: flex; flex-direction: column; color: #584C89; font-size: 12px; font-family: Inter; font-weight: 400; line-height: 20px; word-wrap: break-word">%</div>
                </div>
              </div>
            </div>
          </div>
          <div class="BoxAiUsage" style="flex: 1 1 0; align-self: stretch; background: #F7F8FD; border-radius: 5px; flex-direction: column; justify-content: center; align-items: center; gap: 10px; display: inline-flex">
            <div class="AiUsage" style="align-self: stretch; flex-direction: column; justify-content: center; align-items: center; display: flex">
              <div class="Frame12" style="width: 68px; flex-direction: column; justify-content: center; align-items: center; gap: 4px; display: flex">
                <div class="TeamUtilisation" style="align-self: stretch; text-align: center; justify-content: center; display: flex; flex-direction: column; color: #584C89; font-size: 12px; font-family: Inter; font-weight: 400; word-wrap: break-word">Utilisation</div>
                <div class="Frame23" style="align-self: stretch; justify-content: center; align-items: center; display: inline-flex">
                  <div class="MonthlyTeamUtilsation" style="text-align: center; color: #584C89; font-size: 24px; font-family: Inter; font-weight: 700; word-wrap: break-word">${marketData['monthly-team-utilsation']}</div>
                  <div class="Percentage" style="width: 11px; align-self: stretch; text-align: center; justify-content: flex-end; display: flex; flex-direction: column; color: #584C89; font-size: 12px; font-family: Inter; font-weight: 400; line-height: 20px; word-wrap: break-word">%</div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="SummaryDivide" style="width: 240px; height: 28px; justify-content: flex-start; align-items: flex-start; gap: 8px; display: inline-flex">
          <div class="Ytd" style="width: 24px; align-self: stretch; justify-content: center; display: flex; flex-direction: column; color: #584C89; font-size: 10.70px; font-family: Inter; font-weight: 800; word-wrap: break-word">YTD</div>
        </div>
        <div class="BoxYtdAssets" style="align-self: stretch; height: 58px; position: relative; background: #F7F8FD; border-radius: 5px">
          <div class="YtdAssets" style="width: 186px; padding-top: 7px; padding-bottom: 7px; left: 12px; top: 50%; transform: translateY(-50%); position: absolute; justify-content: space-between; align-items: center; display: inline-flex">
            <div class="Assets" style="justify-content: center; display: flex; flex-direction: column; color: #584C89; font-size: 12px; font-family: Inter; font-weight: 400; word-wrap: break-word">Assets</div>
            <div class="YtdAssetsTotal" style="flex: 1 1 0; text-align: right; justify-content: center; display: flex; flex-direction: column; color: #584C89; font-size: 24px; font-family: Inter; font-weight: 700; word-wrap: break-word">${marketData['ytd-assets-total']}</div>
          </div>
        </div>
        <div class="BoxYtdSavings" style="align-self: stretch; height: 58px; position: relative; background: #F7F8FD; border-radius: 5px">
          <div class="YtdSavings" style="width: 186px; padding-top: 7px; padding-bottom: 7px; left: 12px; top: 50%; transform: translateY(-50%); position: absolute; justify-content: space-between; align-items: center; display: inline-flex">
            <div class="Saving" style="justify-content: center; display: flex; flex-direction: column; color: #584C89; font-size: 12px; font-family: Inter; font-weight: 400; white-space: nowrap; word-wrap: break-word">Saving (€)</div>
            <div class="YtdSavingsTotal" style="text-align: right; justify-content: center; display: flex; flex-direction: column; color: #584C89; font-size: 24px; font-family: Inter; font-weight: 700; word-wrap: break-word">${marketData['ytd-savings-total']}</div>
          </div>
        </div>
        <div class="Frame16" style="width: 240px; height: 75px; justify-content: center; align-items: flex-start; gap: 8px; display: inline-flex">
          <div class="BoxAiUsage" style="flex: 1 1 0; align-self: stretch; background: ${getNPSColor(marketData['market-nps-score'])}; border-radius: 5px; flex-direction: column; justify-content: center; align-items: center; gap: 10px; display: inline-flex">
            <div class="Frame11" style="align-self: stretch; flex: 1 1 0; flex-direction: column; justify-content: center; align-items: center; display: flex">
              <div class="NpsScore" style="align-self: stretch; height: 12px; text-align: center; justify-content: center; display: flex; flex-direction: column; color: ${getNPSTextColor(marketData['market-nps-score'])}; font-size: 12px; font-family: Inter; font-weight: 400; word-wrap: break-word">NPS Score</div>
              <div class="MarketNpsScore" style="align-self: stretch; height: 37px; text-align: center; color: ${getNPSTextColor(marketData['market-nps-score'])}; font-size: 24px; font-family: Inter; font-weight: 700; word-wrap: break-word">${marketData['market-nps-score']}</div>
            </div>
          </div>
          <div class="BoxAiUsage" style="flex: 1 1 0; align-self: stretch; background: #E9FAEF; border-radius: 5px; flex-direction: column; justify-content: center; align-items: center; gap: 10px; display: inline-flex">
            <div class="Frame11" style="width: 73px; flex: 1 1 0; flex-direction: column; justify-content: center; align-items: center; display: flex">
              <div class="Roi" style="align-self: stretch; height: 12px; text-align: center; justify-content: center; display: flex; flex-direction: column; color: #58A97F; font-size: 12px; font-family: Inter; font-weight: 400; word-wrap: break-word">ROI</div>
              <div class="YtdRoiTotal" style="align-self: stretch; height: 37px; text-align: center; color: #58A97F; font-size: 24px; font-family: Inter; font-weight: 700; word-wrap: break-word">${marketData['ytd-roi-total']}</div>
            </div>
          </div>
        </div>
      </div>
    `;
    
    return card;
}

// Function to update global data (left sidebar)
function updateGlobalData() {
    // Calculate total assets from all markets' YTD assets
    let totalAssets = 0;
    Object.values(marketsData).forEach(market => {
        const ytdAssets = parseFloat(market['ytd-assets-total'].replace(/,/g, ''));
        if (!isNaN(ytdAssets)) {
            totalAssets += ytdAssets;
        }
    });
    
    // Calculate total saved from all markets' YTD savings
    let totalSaved = 0;
    Object.values(marketsData).forEach(market => {
        const ytdSavings = parseFloat(market['ytd-savings-total'].replace(/,/g, ''));
        if (!isNaN(ytdSavings)) {
            totalSaved += ytdSavings;
        }
    });
    
    // Format with commas
    globalData['total-assets'] = totalAssets.toLocaleString();
    globalData['total-saved'] = totalSaved.toLocaleString();
    
    // Update all global data elements
    Object.keys(globalData).forEach(layerName => {
        const elements = document.querySelectorAll(`[data-layer="${layerName}"]`);
        elements.forEach(element => {
            element.textContent = globalData[layerName];
        });
    });
    
    // Update top performing markets based on monthly assets
    updateTopPerformingMarkets();
}

// Function to update top performing markets list
function updateTopPerformingMarkets() {
    // Sort markets by monthly assets (descending)
    const sortedMarkets = Object.entries(marketsData)
        .map(([name, data]) => ({
            name: name,
            assets: parseFloat(data['monthly-assets']),
            flag: data['market-flag']
        }))
        .sort((a, b) => b.assets - a.assets);
    
    // Update the list in the UI
    const marketListContainer = document.querySelector('[data-layer="Frame 21"]');
    if (!marketListContainer) return;
    
    marketListContainer.innerHTML = '';
    
    // Show top 5 markets (or all if less than 5)
    sortedMarkets.slice(0, 5).forEach(market => {
        const marketItem = document.createElement('div');
        marketItem.setAttribute('data-layer', 'market');
        marketItem.className = 'Market';
        marketItem.style = 'align-self: stretch; justify-content: flex-start; align-items: center; gap: 9px; display: inline-flex';
        
        marketItem.innerHTML = `
            <img src="${market.flag}" style="width: 21px; height: 21px; border-radius: 9999px; object-fit: cover;" />
            <div style="flex: 1 1 0; color: white; font-size: 14px; font-family: Inter; font-weight: 700; line-height: 32px; word-wrap: break-word">${market.name}</div>
        `;
        
        marketListContainer.appendChild(marketItem);
    });
}

// Function to create a combined sparkline with multiple markets overlaid
function createCombinedSparkline(marketsData, width = 800, height = 150) {
    const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
    
    // Find global min and max across all markets
    let globalMin = Infinity;
    let globalMax = -Infinity;
    
    Object.values(marketsData).forEach(market => {
        if (market['monthly-trend']) {
            const min = Math.min(...market['monthly-trend']);
            const max = Math.max(...market['monthly-trend']);
            globalMin = Math.min(globalMin, min);
            globalMax = Math.max(globalMax, max);
        }
    });
    
    const range = globalMax - globalMin || 1;
    const padding = 20;
    const graphHeight = height - padding * 2;
    const graphWidth = width - padding * 2;
    
    // Color palette for different markets
    const colors = ['#574BB8', '#27DA6D', '#F27430', '#FBD200', '#E94F7A'];
    
    let svg = `
        <svg width="100%" height="${height}" viewBox="0 0 ${width} ${height}" preserveAspectRatio="xMidYMid meet" style="display: block;">
            <!-- Grid lines -->
            <line x1="${padding}" y1="${padding}" x2="${padding}" y2="${height - padding}" stroke="#E5E5E5" stroke-width="1"/>
            <line x1="${padding}" y1="${height - padding}" x2="${width - padding}" y2="${height - padding}" stroke="#E5E5E5" stroke-width="1"/>
    `;
    
    // Add month labels
    months.forEach((month, index) => {
        const x = padding + (index / (months.length - 1)) * graphWidth;
        svg += `<text x="${x}" y="${height - 5}" text-anchor="middle" font-size="10" fill="#9E9AB8" font-family="Inter">${month}</text>`;
    });
    
    // Draw each market's line
    let colorIndex = 0;
    Object.keys(marketsData).forEach(marketName => {
        const marketData = marketsData[marketName];
        const trendData = marketData['monthly-trend'];
        
        if (!trendData) return;
        
        const color = colors[colorIndex % colors.length];
        colorIndex++;
        
        const points = trendData.map((value, index) => {
            const x = padding + (index / (trendData.length - 1)) * graphWidth;
            const y = padding + graphHeight - ((value - globalMin) / range) * graphHeight;
            return `${x},${y}`;
        }).join(' ');
        
        // Draw line
        svg += `
            <polyline
                points="${points}"
                fill="none"
                stroke="${color}"
                stroke-width="3"
                stroke-linecap="round"
                stroke-linejoin="round"
                opacity="0.8"
            />
        `;
        
        // Draw endpoint circle
        const lastValue = trendData[trendData.length - 1];
        const lastX = padding + graphWidth;
        const lastY = padding + graphHeight - ((lastValue - globalMin) / range) * graphHeight;
        svg += `<circle cx="${lastX}" cy="${lastY}" r="4" fill="${color}" />`;
    });
    
    svg += `</svg>`;
    return svg;
}

// Function to generate trending sparklines
function generateTrendingPanel() {
    const container = document.getElementById('trendingContent');
    if (!container) return;
    
    container.innerHTML = '';
    
    // Create the combined graph
    const graphContainer = document.createElement('div');
    graphContainer.style = 'width: 100%; display: flex; flex-direction: column; gap: 16px;';
    
    // Create legend first (for top positioning)
    const legendContainer = document.createElement('div');
    legendContainer.style = 'display: flex; gap: 24px; flex-wrap: wrap; justify-content: flex-end; margin-bottom: 8px;';
    
    const colors = ['#574BB8', '#27DA6D', '#F27430', '#FBD200', '#E94F7A'];
    let colorIndex = 0;
    
    Object.keys(marketsData).forEach(marketName => {
        const marketData = marketsData[marketName];
        const trendData = marketData['monthly-trend'];
        
        if (!trendData) return;
        
        const color = colors[colorIndex % colors.length];
        colorIndex++;
        
        // Calculate trend
        const firstValue = trendData[0];
        const lastValue = trendData[trendData.length - 1];
        const percentChange = ((lastValue - firstValue) / firstValue * 100).toFixed(1);
        const isPositive = percentChange >= 0;
        
        const legendItem = document.createElement('div');
        legendItem.style = 'display: flex; align-items: center; gap: 8px;';
        
        legendItem.innerHTML = `
            <div style="width: 16px; height: 3px; background: ${color}; border-radius: 2px;"></div>
            <img src="${marketData['market-flag']}" style="width: 24px; height: 17px; border-radius: 3px;" />
            <span style="color: #272264; font-size: 14px; font-family: Inter; font-weight: 700;">${marketName}</span>
            <span style="color: ${isPositive ? '#27DA6D' : '#D14545'}; font-size: 12px; font-family: Inter; font-weight: 700;">${isPositive ? '+' : ''}${percentChange}%</span>
            <div style="width: 0; height: 0; border-left: 4px solid transparent; border-right: 4px solid transparent; ${isPositive ? 'border-bottom: 6px solid #27DA6D;' : 'border-top: 6px solid #D14545;'}"></div>
        `;
        
        legendContainer.appendChild(legendItem);
    });
    
    graphContainer.appendChild(legendContainer);
    
    // Add the graph below the legend
    const graphDiv = document.createElement('div');
    graphDiv.style = 'background: #F7F8FD; padding: 24px; border-radius: 8px;';
    graphDiv.innerHTML = createCombinedSparkline(marketsData, 800, 150);
    
    graphContainer.appendChild(graphDiv);
    container.appendChild(graphContainer);
}

// Function to generate all market cards
function generateMarketCards() {
    const container = document.getElementById('marketCardsContainer');
    container.innerHTML = ''; // Clear existing cards
    
    // Create a card for each market
    Object.keys(marketsData).forEach(marketName => {
        const card = createMarketCard(marketName, marketsData[marketName]);
        container.appendChild(card);
    });
}

// Initialize dashboard on load
window.addEventListener('DOMContentLoaded', function() {
    updateGlobalData();
    generateMarketCards();
});
</script>

</body>
</html>
